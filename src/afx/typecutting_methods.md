# שיטות היסטוריות לחיתוך טייפ

**שימו לב:**
חלק זה הוא אופציונלי ומשמש כרקע נוסף למי שרוצה
לראות את הגישות ההיסטוריות ולהתעמק בפרטים שלהן.

## סגנון KaT (עד Usagi Drop)
בקאט משתמשים בקודק
[Lagarith](https://lags.leetcode.net/codec.html)
הן עבור החיתוך והן עבור היצוא.
בחיתוך הטייפ מהוידאו הגולמי של הפרק
משתמשים בוריאנט
`Lagarith YV12`
שכן וידאו מקודד
(עם או בלי אובדן איכות)
הוא לרוב בפורמט זה.
אחרי העבודה על הטייפ,
אנו מייצאים את הוידאו בווריאנט
`Lagarith RGBA`
שכן תוכנות העריכה השונות
(Photoshop, After Effects)
כולן עובדות במרחב הצבעים RGB.

אף על פי שאנו משתמשים בקודק
שבהגדרתו אינו מאבד איכות,
יש מספר מוקשים פוטנציאליים
שמקשים על עבודה נכונה.
ראשית,
אם לא עובדים עם הוריאנטים הנכונים
של הקודק בשלבים השונים,
יכולות להיווצר בעיות בעבודה עם צבעים,
שכן ההמרה בין `RGB` ל-`YUV`
אינה בהכרח משתמשת במטריצות ההמרה הנכונות,
מה שגורם לאובדן פרטים ואי-דיוק בצבעים.
שנית,
אם הוידאו המקודד הוא בפורמט 10 ביט,
הוידאו שנקודד בעזרת `Lagarith`
ירדד את המידע ל-8 ביט,
מה שגורם לאובדן מידע פוטנציאלי במקומות אלו,
ואף לארטיפקטים במקרים מסויימים.

## סגנון פנסאב גרמני

בפנסאב הגרמני משתמשים בקודקים שונים לחיתוך וייצוא הטייפ.
לחיתוך משתמשים בקודק `ProRes 4:2:2 Hi-10`,
[בעזרת סקריפט ייעודי](https://gist.github.com/Frechdachs/fab34383a29c988d8d0c9e22892d35e3).
לאחר העבודה בתוכנות העריכה השונות,
הם משתמשים בקודק
[`UtVideo RGBA 10-bit`](https://github.com/umezawatakeshi/utvideo)
לייצוא הטייפ.

`ProRes` נחשב קודק שהוא
Visually Lossless,
כלומר שיש אובדן פרטים
שעין אדם ממוצעת לא תוכל להבחין בהם.
לכאורה, יש פה אובדן פרטים במידת מה,
אך בפועל אין הבדל בין קבצים אלו לקבצים שאנחנו מייצאים
מ-`Lagarith` לדוגמא.
נשים לב שהוריאנט שהם בחרו הוא בברירת מחדל
תומך בוידאו 10-ביט,
כך שוידאו שמקודד ב-10 ביט לא עובר רידוד ל-8 ביט,
אך וידאו ב-8 ביט עובר "הרחבה" ל-10 ביט,
שזו לא פעולה הרסנית מדי.

`UtVideo` נחשב קודק ללא אובדן נתונים,
בדומה ל-`Lagarith` קודם.
עולה השאלה "מדוע לא להשתמש בו גם לשלב החיתוך?".
התשובה שקיבלתי מהפנסאברים הגרמניים היא שהתמיכה של `UtVideo`
כוידאו שאפשר לפתוח ב-After Effects היא מינימלית ולא בהכרח עובדת,
ולכן הם העדיפו ללכת על `ProRes`,
פורמט שיש בו שימוש נרחב גם בתעשייה הקולנועית.

ישנו עוד הבדל קטן בגישה שלהם:
כדי למנוע עבודה חוזרת
במקרים בהם יש אי-דיוקים בדגימת הפריימים לחיתוכים,
הם נוהגים לקחת 5 פריימים לפני
ו-5 פריימים אחרי הטייפ המקורי.
לכאורה אפשר וכדאי לעשות את זה גם אצלנו,
אך כפי שנראה בהמשך,
בחירה נכונה של שיטת הדגימה
יכולה להבטיח לנו דיוק בחיתוך כמעט תמיד.

## סגנון KaT חדש

החל מתחילת העבודה על דמעת הארנבת,
הוחלט לעשות אוטומציה לחלק מהליכי הקידוד השונים,
ובפרט גם לחיתוך וקידוד טייפים.
האוטומציה שבנינו מקבלת רשימת טייפים מתוזמנים על פי פריימים,
וחותכת קבצי `FFV1`
מתוך הוידאו המפולטר
לפני הקידוד הסופי.
את הטייפים אנו מייצאים בפורמט `Lagarith RGBA`
או בפורמט `UtVideo RGBA 10-bit`,
בהתאם להחלטת המקודד.

הבחירה ב-`FFV1` נעשתה
כדי לאפשר לכלי הקידוד השונים לרוץ על `Linux`,
ובפרט על שרתים חיצוניים שאינם מריצים `Windows`.
בעצם השימוש ב-FFV1 יש יתרון

## סגנון היברידי

הסגנון עליו אנו ממליצים במדריך
הוא סגנון קצת אחר